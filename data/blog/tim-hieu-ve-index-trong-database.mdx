---
title: 'TÃ¬m hiá»ƒu vá» index trong relational database'
date: '2024-02-15'
tags: ['database', 'index', 'sql', 'advanced', 'backend', 'mysql', 'InnoDB']
summary: 'Index lÃ  má»™t khÃ­a cáº¡nh kiáº¿n thá»©c quan trá»ng mÃ  má»i nhÃ  phÃ¡t triá»ƒn Ä‘á»u nÃªn am hiá»ƒu. Tuy nhiÃªn, vá»›i nhá»¯ng ngÆ°á»i má»›i sá»­ dá»¥ng, viá»‡c tÃ¬m hiá»ƒu vá» index cÃ³ thá»ƒ lÃ  má»™t thÃ¡ch thá»©c Ä‘Ã¡ng ká»ƒ. HÃ£y Ä‘á»“ng hÃ nh cÃ¹ng mÃ¬nh Ä‘á»ƒ khÃ¡m phÃ¡ sÃ¢u hÆ¡n vá» khÃ¡i niá»‡m index thÃ´ng qua bÃ i viáº¿t nÃ y nhÃ©.'
lastmod: '2024-02-15'
draft: false
images: ['/static/images/page/blog/tim-hieu-ve-index-trong-database/banner.png']
layout: PostSimple
---

<div className="image-blog flex justify-center border-2 rounded-lg dark:border-0 blog-banner">
    ![banner](/static/images/page/blog/tim-hieu-ve-index-trong-database/banner.png)
</div>

Hi cÃ¡c báº¡n ğŸ‘‹. MÃ¬nh lÃ  HÃ¹ng Anh.

Trong quÃ¡ trÃ¬nh lÃ m viá»‡c vá»›i cÃ¡c há»‡ quáº£n trá»‹ cÆ¡ sá»Ÿ dá»¯ liá»‡u quan há»‡ nhÆ° MySQL, PostgreSQL, ... 
viá»‡c sá»­ dá»¥ng Index Ä‘á»ƒ tÄƒng tá»‘c Ä‘á»™ truy váº¥n dá»¯ liá»‡u lÃ  Ä‘iá»u thiáº¿t yáº¿u. 
Tuy nhiÃªn, Ä‘á»‘i vá»›i nhá»¯ng báº¡n má»›i sá»­ dá»¥ng, viá»‡c tÃ¬m hiá»ƒu vá» Index cÃ³ thá»ƒ gáº·p khÃ´ng Ã­t khÃ³ khÄƒn. 
Báº£n thÃ¢n mÃ¬nh cÅ©ng Ä‘Ã£ tráº£i qua nhá»¯ng thá»i Ä‘iá»ƒm khÃ³ khÄƒn nhÆ° váº­y.
HÃ´m nay, hÃ£y cÃ¹ng mÃ¬nh khÃ¡m phÃ¡ kiáº¿n thá»©c vá» Index Ä‘á»ƒ giÃºp cÃ¡c báº¡n cÃ³ cÃ¡i nhÃ¬n rÃµ rÃ ng hÆ¡n vá» chá»§ Ä‘á» nÃ y nhÃ©!

<TOCInline toc={props.toc} exclude={['Giá»›i thiá»‡u','VÃ­ dá»¥ 1', 'VÃ­ dá»¥ 2', 'VÃ­ dá»¥ 3', 'VÃ­ dá»¥ 4', 'VÃ­ dá»¥ 5']} />

## Index lÃ  gÃ¬?
<div className="image-blog flex justify-center">
    ![what-is-index](/static/images/page/blog/tim-hieu-ve-index-trong-database/what-is-index.jpg)
</div>
Khi chÃºng ta Ä‘á»c má»™t cuá»‘n sÃ¡ch vÃ  muá»‘n nhanh chÃ³ng tÃ¬m Ä‘áº¿n chÆ°Æ¡ng X, chÃºng ta thÆ°á»ng sá»­ dá»¥ng má»¥c lá»¥c Ä‘á»ƒ xÃ¡c Ä‘á»‹nh sá»‘  thá»© tá»± trang cá»§a chÆ°Æ¡ng.
Viá»‡c nÃ y giÃºp chÃºng ta trÃ¡nh pháº£i láº­t tá»«ng trang má»™t Ä‘á»ƒ Ä‘áº¿n trang mong muá»‘n. 
Tuy nhiÃªn, Ä‘iá»u Ä‘Ã¡nh Ä‘á»•i á»Ÿ Ä‘Ã¢y lÃ  cÃ³ thá»ƒ máº¥t má»™t vÃ i trang á»Ÿ Ä‘áº§u sÃ¡ch Ä‘á»ƒ in pháº§n má»¥c lá»¥c.

Index trong cÃ¡c DBMS hoáº¡t Ä‘á»™ng tÆ°Æ¡ng tá»± nhÆ° trÃªn.
Index chá»‰ lÃ  má»™t **cáº¥u trÃºc dá»¯ liá»‡u** Ä‘Æ°á»£c lÆ°u trá»­ trÃªn **á»• Ä‘Ä©a** vÃ  cÃ´ng dá»¥ng cá»§a index giÃºp cho
viá»‡c truy váº¥n dá»¯ liá»‡u tá»« database trá»Ÿ lÃªn nhanh hÆ¡n báº±ng cÃ¡ch giáº£m sá»‘ báº£n ghi pháº£i scan.

TrÆ°á»›c khi vÃ o chi tiáº¿t, mÃ¬nh thá»‘ng nháº¥t chÃºt vá» ngá»¯ cáº£nh cá»§a bÃ i viáº¿t nhÃ©:
- DBMS: MySQL
- Store engine: InnoDB


## PhÃ¢n loáº¡i Index

Index Ä‘Æ°á»£c phÃ¢n loáº¡i theo cÃ¡c yáº¿u tá»‘ sau:

1. Theo cáº¥u trÃºc dá»¯ liá»‡u:
    - B+ Tree index
    - Hash index
    - FullText (inverted) index
    - LMS tree
2. Theo lÆ°u trá»¯ váº­t lÃ½;
    - Clustered index
    - Non-clustered index (Secondary index)
3. Theo sá»‘ lÆ°á»£ng cá»™t
    - Single column index
    - Composite index
4. Theo tÃ­nh cháº¥t
    - Primary key index
    - Unique index
    - Prefix index

_á» Ä‘Ã¢y mÃ¬nh cÃ³ má»™t lÆ°u Ã½ ráº±ng, khi mÃ  Ä‘Æ°á»£c há»i Index Ä‘Æ°á»£c phÃ¢n ra lÃ m máº¥y loáº¡i, thÃ¬ lÃºc nÃ y mÃ¬nh sáº½ pháº£i há»i thÃªm ráº±ng
Ã½ ngÆ°á»i há»i muá»‘n phÃ¢n loáº¡i index theo yáº¿u tá»‘ gÃ¬. Máº·c Ä‘á»‹nh náº¿u khÃ´ng nÃ³i gÃ¬ thÃªm thÃ¬ mÃ¬nh cÃ³ thá»ƒ hiá»ƒu Ä‘Ã³ lÃ  phÃ¢n loáº¡i index theo cáº¥u
trÃºc dá»¯ liá»‡u._

Pháº§n bÃªn dÆ°á»›i mÃ¬nh cÃ¹ng tÃ¬m hiá»ƒu cÃ¡c má»™t sá»‘ cÃ¡c loáº¡i index hay sá»­ dá»¥ng nhÃ©.

### Theo cáº¥u trÃºc dá»¯ liá»‡u
#### B+ Tree Index

Má»—i khi chÃºng ta Ä‘Ã¡nh index trÃªn cÃ¡c cá»™t cá»§a má»™t báº£ng, thÃ¬ DBMS sáº½ build ra má»™t cáº¥u trÃºc dá»¯ liá»‡u B+ Tree dá»±a trÃªn dá»¯ liá»‡u
cá»§a cÃ¡c cá»™t Ä‘Ã³.
<div className="image-blog flex justify-center">
    ![b+tree](/static/images/page/blog/tim-hieu-ve-index-trong-database/b+tree.png)
</div>

Cáº¥u trÃºc dá»¯ liá»‡u B+ Tree cÃ³ cÃ¡c Ä‘áº·c Ä‘iá»ƒm sau:
- Má»—i node trung gian sáº½ chá»©a nhiá»u key
    - Giáº£m Ä‘á»™ cao cá»§a cÃ¢y
    - Giáº£m sá»‘ láº§n Ä‘á»c giÃ¡ trá»‹ cÃ¡c node trong á»• Ä‘Ä©a
- CÃ¡c node lÃ¡ sáº½ Ä‘Æ°á»£c liÃªn káº¿t vá»›i nhau trong má»™t linked list
    - Hiá»‡u quáº£ hÆ¡n khi truy váº¥n cÃ¡c giÃ¡ trá»‹ theo khoáº£ng (chá»‰ cáº§n tÃ¬m ra node lÃ¡ Ä‘áº§u tiÃªn 
        thá»a mÃ£n Ä‘iá»u kiá»‡n vÃ  duyá»‡t next tiáº¿p cÃ¡c node lÃ¡ cho Ä‘áº¿n khi gáº·p node lÃ¡ cuá»‘i cÃ¹ng thá»a mÃ£n Ä‘iá»u kiá»‡n thÃ¬ dá»«ng).
- CÃ¡c node lÃ¡ sáº½ cÃ³ con trá» Ä‘á»ƒ trá» tá»›i báº£n ghi thá»±c táº¿


#### Hash Index
Khi chÃºng ta sá»­ dá»¥ng hash index trÃªn cÃ¡c cá»™t cá»§a má»™t báº£ng,
thÃ¬ DBMS sáº½ sá»­ dá»¥ng má»™t hÃ m hash Ä‘á»ƒ  bÄƒm dá»¯ liá»‡u cá»§a cá»™t Ä‘Ã³ vÃ  map chÃºng vá»›i cÃ¡c Ä‘á»‹a chá»‰ cá»¥ thá»ƒ cá»§a cÃ¡c báº£n ghi.

<div className="image-blog flex justify-center">
    ![hash-index](/static/images/page/blog/tim-hieu-ve-index-trong-database/hash-index.png)
</div>

- Æ¯u Ä‘iá»ƒm:
    - ThÃ­ch há»£p sá»­ dá»¥ng vá»›i cÃ¡c truy váº¥n so sÃ¡nh "="
    - KhÃ´ng tá»‘n nhiá»u bá»™ nhá»› nhÆ° B+ Tree Ä‘á»ƒ triá»ƒn khai hash index

- NhÆ°á»£c Ä‘iá»ƒm:
    - KhÃ´ng phÃ¹ há»£p vá»›i cÃ¡c truy váº¥n theo khoáº£ng vÃ  sáº¯p xáº¿p
    - CÃ³ thá»ƒ xáº£y ra Ä‘á»¥ng Ä‘á»™ khi hai giÃ¡ trá»‹ khÃ¡c nhau nhÆ°ng giÃ¡ trá»‹ káº¿t quáº£ hash láº¡i giá»‘ng nhau


### Theo lÆ°u trá»¯ váº­t lÃ½
#### Clustered index
Clustered index Ä‘á»‹nh nghÄ©a cÃ¡ch thá»©c mÃ  dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trá»¯ váº­t lÃ½ trong má»™t báº£ng.

Hiá»ƒu má»™t cÃ¡ch thÃ´ng thÆ°á»ng ráº±ng, khi má»™t cá»™t Ä‘Æ°á»£c Ä‘Ã¡nh clustered index thÃ¬ toÃ n bá»™ cÃ¡c row sáº½ Ä‘Æ°á»£c tá»• chá»©c lÆ°u trá»¯ trong má»™t cáº¥u trÃºc dá»¯ liá»‡u
(thÆ°á»ng lÃ  B+ Tree) vÃ  nÃ³ sáº½ cÃ³ nhá»¯ng Ä‘áº·c Ä‘iá»ƒm sau:
- Nhá»¯ng node trung gian sáº½ chá»‰ lÆ°u giÃ¡ trá»‹ cá»§a cá»™t Ä‘Æ°á»£c Ä‘Ã¡nh index.
- Nhá»¯ng node lÃ¡ sáº½ lÆ°u **dá»¯ liá»‡u thá»±c táº¿** cá»§a báº£n ghi

NhÆ° váº­y, khi má»™t cá»™t Ä‘Æ°á»£c Ä‘Ã¡nh clustered index, thÃ¬ clustered index sáº½ quyáº¿t Ä‘á»‹nh giÃ¡ trá»‹ cá»§a cá»™t Ä‘Ã³ náº±m á»Ÿ cÃ¡c node trung gian,
cÃ²n node lÃ¡ sáº½ chá»©a giÃ¡ trá»‹ thá»±c táº¿ cá»§a báº£n ghi.

<div className="image-blog flex justify-center">
    ![clustered-index](/static/images/page/blog/tim-hieu-ve-index-trong-database/clustered-index.webp)
</div>

Má»™t table cÃ³ má»™t clustered index. Máº·c Ä‘á»‹nh InnoDB engine sáº½ tá»± táº¡o ra má»™t clustered index theo nguyÃªn táº¯c sau:
- Náº¿u cÃ³ cá»™t primary key â” ÄÃ¡nh clustered index dá»±a trÃªn cá»™t primary key
- Náº¿u khÃ´ng cÃ³ primary key â” Láº¥y cá»™t unique vÃ  not null Ä‘á»ƒ Ä‘Ã¡nh clustered index
- Náº¿u khÃ´ng cÃ³ cá»™t nÃ o unique vÃ  not null â” InnoDB engine sáº½ tá»± táº¡o 3 hidden columns (DB_ROW_ID, DB_TRX_ID, DB_ROLL_PTR) lÃ m primary key vÃ  Ä‘Ã¡nh clustered index.

#### Non-clustered index
CÃ¡c index khÃ´ng pháº£i lÃ  clustered index thÃ¬ Ä‘á»u lÃ  non-clustered (secondary) index.

<div className="image-blog flex justify-center">
    ![non-clustered-index](/static/images/page/blog/tim-hieu-ve-index-trong-database/non-clustered-index.webp)
</div>

Non-clustered (secondary) index sáº½ cÃ³ nhá»¯ng Ä‘áº·c Ä‘iá»ƒm sau:
- GiÃ¡ trá»‹ cá»§a node lÃ¡ lÃ  giÃ¡ trá»‹ cá»§a cá»™t Ä‘Æ°á»£c Ä‘Ã¡nh clustered index.
- Má»—i má»™t table thÃ¬ sáº½ cÃ³ thá»ƒ cÃ³ nhiá»u non-clustered index.

Tá»« hÃ¬nh áº£nh minh há»a trÃªn, giáº£ sá»­ chÃºng ta coi ráº±ng clustered index Ä‘Æ°á»£c Ä‘Ã¡nh trÃªn cá»™t primary key vÃ  non-clustered index Ä‘Æ°á»£c Ä‘Ã¡nh trÃªn cá»™t email.
Khi chÃºng ta thá»±c hiá»‡n cÃ¢u lá»‡nh bÃªn dÆ°á»›i Ä‘Ã¢y:
```js
SELECT * FROM table WHERE email = 'eamil_search';
```
LÃºc nÃ y InnoDB sáº½ thá»±c hiá»‡n tÃ¬m kiáº¿m trÃªn cÃ¢y B+ Tree cá»§a cá»™t email, sau khi tÃ¬m Ä‘Æ°á»£c node lÃ¡ tÆ°Æ¡ng á»©ng thÃ¬
nÃ³ tiáº¿p tá»¥c cáº§m giÃ¡ trá»‹ cá»§a node lÃ¡ nÃ y (chÃ­nh lÃ  key cá»§a cÃ¢y clustered index) Ä‘á»ƒ quÃ©t trÃªn cÃ¢y B+ Tree cá»§a 
clustered index vÃ  tráº£ vá» giÃ¡ trá»‹ Ä‘áº§y Ä‘á»§ cá»§a truy váº¥n.

Hmm, Ä‘áº¿n Ä‘Ã¢y ae mÃ¬nh sáº½ cÃ³ má»™t tháº¯c máº¯c lÃ :
> Táº¡i sao non-clustered index khÃ´ng lÆ°u dá»¯ liá»‡u cá»§a báº£n ghi hoáº·c Ä‘á»‹a chá»‰ Ã´ nhá»› cá»§a báº£n ghi bÃªn trong node lÃ¡ Ä‘á»ƒ Ä‘á»¡ pháº£i duyá»‡t cÃ¢y 2 láº§n nhá»‰?

MÃ¬nh nghÄ© do má»™t vÃ i lÃ½ do sau Ä‘Ã¢y mÃ  InnoDB sáº½ khÃ´ng lÃ m nhÆ° tháº¿:
- Dá»¯ liá»‡u báº£n ghi cÃ³ thá»ƒ thay Ä‘á»•i â” Pháº£i cáº­p nháº­t dá»¯ liá»‡u trÃªn táº¥t cáº£ cÃ¡c node lÃ¡ cá»§a cÃ¡c cÃ¢y non-clustered index.
- Äá»‹a chá»‰ Ã´ nhá»› cá»§a báº£n ghi cÅ©ng cÃ³ thá»ƒ thay Ä‘á»•i â” Pháº£i cáº­p nháº­t Ä‘á»‹a chá»‰ Ã´ nhá»› cá»§a báº£n ghi trÃªn táº¥t cáº£ cÃ¡c node lÃ¡ cá»§a cÃ¡c cÃ¢y non-clustered index.

Cáº£ hai cÃ¡ch Ä‘á»u ráº¥t tá»‘n thá»i gian Ä‘á»ƒ thá»±c hiá»‡n. CÃ²n náº¿u nhÆ° mÃ´ hÃ¬nh hiá»‡n táº¡i thÃ¬ lÃºc nÃ y khi cÃ³ thay Ä‘á»•i dá»¯ liá»‡u,
InnoDB chá»‰ cáº§n cáº­p nháº­t dá»¯ liá»‡u á»Ÿ cÃ¢y clustered index lÃ  Ä‘Æ°á»£c.

NhÆ°á»£c Ä‘iá»ƒm cá»§a non-clustered index.
- CÃ¡c thao tÃ¡c ghi sáº½ bá»‹ cháº­m hÆ¡n (do khi thay thÃªm hoáº·c thay Ä‘á»•i dá»¯ liá»‡u trÃªn cá»™t Ä‘Ã¡nh index thÃ¬ nÃ³ sáº½ pháº£i cáº­p nháº­t cÃ¡c cÃ¢y B+ Tree).
- CÃ ng cÃ³ nhiá»u non-clustered index sáº½ cÃ ng tá»‘n nhiá»u khÃ´ng gian nhá»› (do pháº£i build vÃ  lÆ°u trá»¯ nhiá»u cÃ¢y B+ Tree).
- Máº¥t thá»i gian khi táº¡o cÃ¡c index vÃ  báº£o trÃ¬ cÃ¡c index.
- Pháº£i duyá»‡t cÃ¢y 2 láº§n (tÄƒng thá»i gian I/O á»• Ä‘Ä©a).

### Theo tÃ­nh cháº¥t
TrÆ°á»›c khi Ä‘i vÃ o pháº§n nÃ y, mÃ¬nh sáº½ lÃ m rÃµ má»™t chÃºt khÃ¡i niá»‡m vá» `key` vÃ  `index` nhÃ©.
> Sá»± khÃ¡c nhau giá»¯a key vÃ  index?

Máº·c dÃ¹, khÃ¡i niÃªm key vÃ  index thÆ°á»ng Ä‘c Ä‘Ã¡nh Ä‘á»“ng vá»›i nhau nhÆ°ng tÆ° tÆ°á»Ÿng 2 khÃ¡i niá»‡m nÃ y lÃ  khÃ¡c nhau:
- Key: LÃ  má»™t **rÃ ng buá»™c** Ã¡p Ä‘áº·t lÃªn hÃ nh vi cá»§a cá»™t. VÃ­ dá»¥: khÃ³a chÃ­nh lÃ  trÆ°á»ng khÃ´ng thá»ƒ rá»—ng, xÃ¡c Ä‘á»‹nh duy nháº¥t má»—i hÃ ng.
- Index: LÃ  má»™t **cáº¥u trÃºc dá»¯ liá»‡u Ä‘áº·c biá»‡t** táº¡o Ä‘iá»u kiá»‡n cho viá»‡c tÃ¬m kiáº¿m trá»Ÿ lÃªn nhanh chÃ³ng, ko cÃ³ tÆ° tÆ°á»Ÿng rÃ ng buá»™c á»Ÿ Ä‘Ã¢y.

#### Primary Index
Primary index lÃ  má»™t loáº¡i index Ä‘Ã³ng vai trÃ² lÃ  mÃ£ Ä‘á»‹nh danh duy nháº¥t cho má»—i hÃ ng trong báº£ng.

<div className="image-blog flex justify-center">
    ![primary-index](/static/images/page/blog/tim-hieu-ve-index-trong-database/primary-index.webp)
</div>

Khi chÃºng ta táº¡o ra má»™t primary key, thÃ¬ InnoDB engine cÅ©ng sáº½ táº¡o ra má»™t primary index tÆ°Æ¡ng á»©ng. Primary index khÃ´ng cho phÃ©p giÃ¡ trá»‹ null.

Primary Key Ä‘áº¹p nháº¥t lÃ  Ä‘á»ƒ kiá»ƒu INT hoáº·c BIGINT, Ä‘Æ¡n giáº£n vÃ¬ so sÃ¡nh int nhanh hÆ¡n,
duyá»‡t index sáº½ nhanh hÆ¡n vÃ  thao tÃ¡c ghi tá»« Ä‘Ã³ cÅ©ng trá»Ÿ nÃªn nhanh hÆ¡n.
Táº¥t nhiÃªn dÃ¹ng primary key kiá»ƒu int cÅ©ng cÃ³ má»™t sá»‘ nhÆ°á»£c Ä‘iá»ƒm vÃ­ dá»¥ vá» máº·t security, attacker dá»… Ä‘oÃ¡n Ä‘c cÃ¡c id key káº¿ tiáº¿p.
TÃ¹y vÃ o hoÃ n cáº£nh, ae chá»n kiá»ƒu cho primary key phÃ¹ há»£p nhÃ©.

#### Unique Index
Unique index lÃ  má»™t cáº¥u trÃºc dá»¯ liá»‡u mÃ  nÃ³ Ä‘áº£m báº£o giÃ¡ trá»‹ cá»§a cá»™t (hoáº·c cÃ¡c cá»™t) trong báº£ng lÃ  duy nháº¥t, tá»©c lÃ  khÃ´ng cÃ³ giÃ¡ trá»‹ trÃ¹ng láº·p, nhÆ°ng cho phÃ©p cÃ³ giÃ¡ trá»‹ null.

<div className="image-blog flex justify-center">
    ![unique-index](/static/images/page/blog/tim-hieu-ve-index-trong-database/unique-index.png)
</div>

Äá»ƒ táº¡o má»™t unique index, ta viáº¿t theo cÃº phÃ¡p nhÆ° sau:
```js
CREATE UNIQUE INDEX index_name ON table_name(index_column_1,index_column_2,...);
```

### Theo sá»‘ lÆ°á»£ng cá»™t

#### Composite Index
Composite Index lÃ  index Ä‘Æ°á»£c Ä‘Ã¡nh trÃªn nhiá»u cá»™t. Má»™t composite index cÃ ng cÃ³ nhiá»u cá»™t thÃ¬ cÃ ng sá»­ dá»¥ng nhiá»u dung lÆ°á»£ng lÆ°u trá»¯.

Äá»ƒ Ä‘á»… hiá»ƒu hÆ¡n, mÃ¬nh láº¥y má»™t vÃ­ dá»¥: Giáº£ sá»­ mÃ¬nh Ä‘Ã¡nh omposite index trÃªn hai cá»™t lÃ  **name** vÃ  **country** nhÆ° hÃ¬nh bÃªn dÆ°á»›i Ä‘Ã¢y.

<div className="image-blog flex justify-center">
    ![composite-index](/static/images/page/blog/tim-hieu-ve-index-trong-database/composite-index.png)
</div>

InnoDB engine sáº½ build ra cÃ¡c cÃ¢y B+ Tree bao gá»“m cÃ¢y clustered index vÃ  cÃ¢y cho cá»™t **name**, cÃ¡c cÃ¢y cho cá»™t **country**.
<div className="image-blog flex justify-center">
    ![composite-index-explane](/static/images/page/blog/tim-hieu-ve-index-trong-database/composite-index-explane.png)
</div>

CÃ¡c node lÃ¡ cá»§a cÃ¢y name sáº½ trá» tá»›i cÃ¡c node gá»‘c cá»§a cÃ¢y country tÆ°Æ¡ng á»©ng, cÃ¡c node lÃ¡ cá»§a cÃ¢y country sáº½ chá»©a giÃ¡ trá»‹ key cá»§a clustered index.
Khi duyá»‡t xong cÃ¢y composite index thÃ¬ chÃºng ta sáº½ cÃ³ Ä‘Æ°á»£c giÃ¡ trá»‹ key cá»§a clustered index, rá»“i tá»« Ä‘Ã³ má»›i duyá»‡t tiáº¿p cÃ¢y clustered index Ä‘á»ƒ láº¥y ra giÃ¡ trá»‹ truy váº¥n.

Tá»›i Ä‘Ã¢y, mÃ¬nh cÃ³ má»™t bÃ i thá»±c hÃ nh nhá». Giáº£ sá»­ mÃ¬nh cÃ³ má»™t composite index Ä‘Æ°á»£c Ä‘Ã¡nh trÃªn ba cá»™t (country, provine, name). Theo ae thÃ¬ cÃ¢u query nÃ o dÆ°á»›i Ä‘Ã¢y sáº½ sá»­ dá»¥ng index.

```js showLineNumbers
SELECT * FROM customers WHERE provine = â€˜Texasâ€™ AND country = â€˜USâ€™; 
SELECT * FROM customers WHERE provine = â€˜Texasâ€™; 
SELECT * FROM customers WHERE name = â€˜JANEâ€™ AND provine = â€˜Texasâ€™; 
SELECT * FROM customers WHERE country = â€˜USâ€™;
```

CÃ¢u tráº£ lá»i lÃ  cÃ¢u query sá»‘ 1 vÃ  sá»‘ 4 sáº½ sá»­ dá»¥ng index.

Khi chÃºng ta táº¡o composite index trÃªn ba cá»™t (country, provine, name), thÃ¬ cÃ¢y country sáº½ Ä‘Æ°á»£c táº¡o Ä‘áº§u tiÃªn.
CÃ¡c node lÃ¡ cá»§a cÃ¢y country sáº½ trá» tá»›i cÃ¡c node gá»‘c cá»§a cÃ¢y provine tÆ°Æ¡ng á»©ng.
CÃ¡c node lÃ¡ cá»§a cÃ¢y provine cÅ©ng sáº½ trá» tá»›i cÃ¡c node gá»‘c cá»§a cÃ¢y name tÆ°Æ¡ng á»©ng.

ChÃºng ta hÃ£y Ä‘i láº¡i qua tá»«ng cÃ¢u query nhÃ©.

CÃ¢u query sá»‘ 1:
```js
1. SELECT * FROM customers WHERE provine = â€˜Texasâ€™ AND country = â€˜USâ€™;
```
CÃ¢u query sá»‘ 1 sá»­ dá»¥ng index bá»Ÿi vÃ¬ thá»© tá»± trong cÃ¢u Ä‘iá»n kiá»‡n WHERE cÃ³ thá»ƒ thay Ä‘á»•i, tá»©c lÃ  InnoDB sáº½ tá»± Ä‘á»™ng Ä‘áº£o Ä‘iá»u kiá»‡n country lÃªn trÆ°á»›c Ä‘iá»u kiá»‡n provine thÃ nh Ä‘iá»u kiá»‡n
(country = â€˜USâ€™ AND provine = â€˜Texasâ€™). Do Ä‘Ã³ InnoDB váº«n sáº½ duyá»‡t Ä‘Æ°á»£c cÃ¢y country trÆ°á»›c rá»“i duyá»‡t tiáº¿p cÃ¢y provine Ä‘á»ƒ láº¥y káº¿t quáº£.

CÃ¢u query sá»‘ 2:
```js
2. SELECT * FROM customers WHERE provine = â€˜Texasâ€™;
```
CÃ¢u query sá»‘ 2 khÃ´ng sá»­ dá»¥ng index bá»Ÿi vÃ¬ Ä‘iá»u kiá»‡n khÃ´ng cÃ³ lá»c theo country nÃªn InnoDB hoÃ n toÃ n khÃ´ng thá»ƒ duyá»‡t Ä‘Æ°á»£c cÃ¢y index.

CÃ¢u query sá»‘ 3:
```js
3. SELECT * FROM customers WHERE name = â€˜JANEâ€™ AND provine = â€˜Texasâ€™; 
```
CÃ¢u query sá»‘ 3 cÅ©ng khÃ´ng sá»­ dá»¥ng index giá»‘ng vá»›i cÃ¢u query sá»‘ 2, bá»Ÿi vÃ¬ Ä‘iá»u kiá»‡n khÃ´ng cÃ³ lá»c theo country. NÃªn InnoDB cÅ©ng khÃ´ng thá»ƒ duyá»‡t Ä‘Æ°á»£c cÃ¢y index.

CÃ¢u query sá»‘ 4:
```js
4. SELECT * FROM customers WHERE country = â€˜USâ€™;
```
CÃ¢u query sá»‘ 4 sá»­ dá»¥ng index bá»Ÿi vÃ¬ cÃ³ Ä‘iá»u kiá»‡n lá»c country. NÃªn InnoDB sáº½ duyá»‡t Ä‘Æ°á»£c cÃ¢y country trÆ°á»›c. CÃ¡c Ä‘iá»u kiá»‡n lá»c theo provine vÃ  name khÃ´ng cÃ³ thÃ¬ nÃ³ láº¥y táº¥t cáº£ cÃ¡c báº£n ghi.


Tá»« Ä‘Ã¢y thÃ¬ chÃºng ta cÃ³ thá»ƒ nháº­n Ä‘á»‹nh ráº±ng:
> Thá»­ tá»± cÃ¡c cá»™t trong composite index lÃ  quan trá»ng.

Váº­y lÃ m tháº¿ nÃ o Ä‘á»ƒ mÃ¬nh cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh Ä‘Ãºng thá»© tá»± cÃ¡c cá»™t khi sá»­ dá»¥ng composite index?

HÆ°á»›ng tiáº¿p cáº­p Ä‘Ã³ lÃ : **Cá»™t nÃ o cÃ³ sá»‘ lÆ°á»£ng giÃ¡ trá»‹ riÃªng biá»‡t cao thÃ¬ sáº¯p xáº¿p lÃªn trÆ°á»›c**.

Quay láº¡i vÃ­ dá»¥ trÆ°á»›c, liá»‡u thá»© tá»± cÃ¡c cá»™t (country, provine, name) trong composite index Ä‘Ã£ há»£p lÃ½ chÆ°a?

Sá»‘ lÆ°á»£ng country trÃªn tháº¿ giá»›i cÃ³ khoáº£ng 200 nÆ°á»›c. Má»—i nÆ°á»›c cÃ³ khoáº£ng 300 provine. ÄÃ¢y Ä‘á»u lÃ  cÃ¡c con sá»‘ há»¯u háº¡n. NhÆ°ng Ä‘á»‘i vá»›i trÆ°á»ng name thÃ¬ sáº½ cÃ³ ráº¥t nhiá»u tÃªn khÃ¡c nhau trÃªn tháº¿ giá»›i.
ChÃ­nh vÃ¬ váº­y, thá»© tá»± cÃ¡c cá»™t chÃºng ta pháº£i sá»­a láº¡i thá»© tá»± thÃ nh (name, provine, country) thÃ¬ má»›i tá»‘i Æ°u Ä‘Æ°á»£c tá»‘c Ä‘á»™ truy váº¥n.


#### Covering Index
Covering Index lÃ  composite index Ä‘Æ°á»£c Ä‘Ã¡nh trÃªn táº¥t cáº£ cÃ¡c cá»™t cÃ³ trong cÃ¢u select.

Giáº£ sá»­ mÃ¬nh cÃ³ cÃ¢u lá»‡nh select:
```js
SELECT FirstName, LastName FROM customers WHERE country = â€˜USâ€™;
```
LÃºc nÃ y mÃ¬nh Ä‘Ã¡nh composite index trÃªn cáº£ ba cá»™t (FirstName, LastName, country) thÃ¬ Ä‘Ã¢y Ä‘Æ°á»£c gá»i lÃ  Covering Index.

<div className="image-blog flex justify-center">
    ![covering-index](/static/images/page/blog/tim-hieu-ve-index-trong-database/covering-index.png)
</div>

Do cÃ¡c dá»¯ liá»‡u cáº§n truy váº¥n Ä‘Ã£ náº±m háº¿t trÃªn cÃ¡c node cá»§a cÃ¡c cÃ¢y rá»“i, nÃªn khi duyá»‡t xong cÃ¢y covering index,
DBMS khÃ´ng cáº§n pháº£i tham chiáº¿u sang cÃ¢y clustered index ná»¯a, tá»« Ä‘Ã³ giáº£m thiá»ƒu Ä‘Æ°á»£c thá»i gian duyá»‡t cÃ¢y vÃ  cáº£i thiá»‡n hiá»‡u suáº¥t cá»§a truy váº¥n.

Äá»‘i vá»›i cÃ¡c cÃ¢u truy váº¥n Ã­t cá»™t vÃ  thÆ°á»ng xuyÃªn Ä‘Æ°á»£c gá»i thÃ¬ mÃ¬nh nÃªn táº­n dá»¥ng covering index.
Tuy nhiÃªn sá»‘ lÆ°á»£ng cá»™t chÃºng ta cÅ©ng chá»‰ nÃªn giá»›i háº¡n $\le$ 5.
ÄÃ¢y lÃ  má»™t khuyáº¿n cÃ¡o thÃ´i, cÅ©ng tÃ¹y vÃ o tÃ¬nh hÃ¬nh thá»±c táº¿ mÃ  ae cÃ¢n nháº¯c con sá»‘ sao cho há»£p lÃ½.

## CÃ¡c loáº¡i index khÃ¡c
- PhÃ¢n loáº¡i theo cáº¥u trÃºc dá»¯ liá»‡u
    - Fulltext Index: Sá»­ dá»¥ng cáº¥u trÃºc dá»¯ liá»‡u Inverted, phÃ¹ há»£p vá»›i tÃ¬m kiáº¿m vÄƒn báº£n.
    - Spatial Index: LÃ  index phÃ¹ há»£p tÃ¬m kiáº¿m trong khÃ´ng gian, vá»‹ trÃ­ kinh Ä‘á»™, vÄ© Ä‘á»™, bÃ¡n kÃ­nh.
    - Bitmap Index: PhÃ¹ há»£p vá»›i bÃ i toÃ¡n tÃ¬m giao, tÃ¬m há»£p cá»§a dá»¯ liá»‡u.

## CÃ¡ch sá»­ dá»¥ng index
KhÃ´ng pháº£i lÃºc nÃ o chÃºng ta cÅ©ng nÃªn sá»­ dá»¥ng index. Index cÅ©ng cÃ³ hai máº·t, náº¿u chÃºng ta sá»­ dá»¥ng khÃ´ng cáº©n tháº­n thÃ¬ sáº½ dáº§n Ä‘áº¿n
truy váº¥n cháº­m hÆ¡n. DÆ°á»›i Ä‘Ã¢y mÃ¬nh cÃ³ tá»•ng há»£p má»™t sá»‘ trÆ°á»ng há»£p nÃªn vÃ  khÃ´ng nÃªn sá»­ dá»¥ng index.

- NÃªn sá»­ dá»¥ng index khi:
    - CÃ³ nhiá»u truy váº¥n thÆ°á»ng gáº·p sá»­ dá»¥ng WHERE, JOIN, GROUP BY, ORDER BY.
    - TÃ¬m má»™t táº­p nhá» record
    - TÃ¬m dá»¯ liá»‡u theo cÃ¡c cá»™t cÃ³ cÃ³ tÃ­nh cháº¥t Ä‘á»‹nh danh hoáº·c unique nhÆ° product_id.

- KhÃ´ng nÃªn sá»­ dá»¥ng index khi:
    - Cá»™t cÃ³ sá»‘ lÆ°á»£ng giÃ¡ trá»‹ riÃªng biá»‡t tháº¥p. VÃ­ dá»¥ nhÆ° gender (chá»‰ cÃ³ 2 giÃ¡ trá»‹ Male vÃ  Femail).
    - Sá»‘ lÆ°á»£ng báº£n ghi trong báº£ng ráº¥t Ã­t.

## Thá»±c hÃ nh
### VÃ­ dá»¥ 1
MÃ¬nh Ä‘Ã¡nh index trÃªn cá»™t **name**, theo ae cÃ¢u truy váº¥n MySQL nÃ o dÆ°á»›i Ä‘Ã¢y sá»­ dá»¥ng index.
```js showLineNumbers
SELECT * FROM users WHERE name LIKE â€˜%peterâ€™;
SELECT * FROM users WHERE name LIKE â€˜peter%â€™;
SELECT * FROM users WHERE name LIKE â€˜%peter%â€™;
```
Tráº£ lá»i: CÃ¢u truy váº¥n sá»‘ 2 sáº½ sá»­ dá»¥ng index.

Giáº£i thÃ­ch: Äá»‘i vá»›i cá»™t Ä‘Æ°á»£c Ä‘Ã¡nh index mÃ  cÃ³ kiá»ƒu dá»¯ liá»‡u lÃ  varchar thÃ¬ DBMS sáº½ xÃ¢y dá»±ng cÃ¢y index dÆ°á»›i dáº¡ng prefix.
Do Ä‘Ã³ khi mÃ  mÃ¬nh truy váº¥n â€˜%peterâ€™ hoáº·c â€˜%peter%â€™ thÃ¬ DBMS sáº½ khÃ´ng biáº¿t pháº£i duyá»‡t tá»« Ä‘Ã¢u.

<div className="image-blog flex justify-center">
    ![prefix-index](/static/images/page/blog/tim-hieu-ve-index-trong-database/prefix-index.webp)
</div>

_ChÃº Ã½: Äá»‘i vá»›i PostgreSQL thÃ¬ truy váº¥n vá»›i LIKE sáº½ khÃ´ng sá»­ dá»¥ng index, do Ä‘Ã³ trong PostgreSQL cáº£ 3 cÃ¢u truy váº¥n trÃªn Ä‘á»u khÃ´ng sá»­ dá»¥ng index._

### VÃ­ dá»¥ 2
MÃ¬nh Ä‘Ã¡nh index trÃªn cá»™t **id**, theo ae cÃ¢u truy váº¥n dÆ°á»›i Ä‘Ã¢y cÃ³ sá»­ dá»¥ng index khÃ´ng?
```js
SELECT * FROM users WHERE id = 1 OR age = 18;
```
Tráº£ lá»i: CÃ¢u truy váº¥n trÃªn khÃ´ng sá»­ dá»¥ng index.


Giáº£i thÃ­ch: Do cá»™t age khÃ´ng Ä‘Æ°á»£c Ä‘Ã¡nh index, nÃªn DBMS sáº½ pháº£i duyá»‡t cÃ¡c hÃ ng trong báº£ng Ä‘á»ƒ kiá»ƒm tra cá»™t age cÃ³ pháº£i báº±ng 18 khÃ´ng.


### VÃ­ dá»¥ 3
MÃ¬nh Ä‘Ã¡nh index trÃªn cá»™t **id**, nhÆ°ng cÃ¢u Ä‘áº§u tiÃªn cá»™t id lÃ  kiá»ƒu int, cÃ¢u sá»‘ 2 cá»™t id lÃ  kiá»ƒu varchar,
theo ae cáº£ 2 cÃ¢u truy váº¥n dÆ°á»›i Ä‘Ã¢y cÃ³ sá»­ dá»¥ng index khÃ´ng?
```js showLineNumbers
SELECT * FROM users WHERE id = â€˜10â€™; // Column â€˜idâ€™: int
SELECT * FROM users WHERE id = 10; // Column â€˜idâ€™: varchar
```
Tráº£ lá»i: CÃ¢u truy váº¥n sá»‘ 1 sá»­ dá»¥ng index.

Giáº£i thÃ­ch: Hai cÃ¢u truy váº¥n trÃªn cÃ³ Ä‘iá»u kiá»‡n so sÃ¡nh mÃ  cáº£ hai váº¿ Ä‘á»u khÃ¡c kiá»ƒu dá»¯ liá»‡u. MySQL pháº£i chuyá»ƒn Ä‘á»•i vá» cÃ¹ng kiá»ƒu rá»“i má»›i so sÃ¡nh Ä‘Æ°á»£c.
MySQL Æ°u tiÃªn viá»‡c chuyá»ƒn Ä‘á»•i kiá»ƒu kÃ½ tá»± vá» kiá»ƒu sá»‘ Ä‘á»ƒ so sÃ¡nh, vÃ¬ máº·c Ä‘á»‹nh so sÃ¡nh hai kiá»ƒu sá»‘ thÃ¬ sáº½ nhanh hÆ¡n.
Logic chuyá»ƒn Ä‘á»•i kiá»ƒu nhÆ° sau:
- Náº¿u cá»™t lÃ  kiá»ƒu sá»‘, giÃ¡ trá»‹ so sÃ¡nh lÃ  kiá»ƒu kÃ½ tá»±
    â” MySQL convert giÃ¡ trá»‹ kÃ½ tá»± vá» kiá»ƒu sá»‘ rá»“i so sÃ¡nh
    â” Convert tá»« '10' vá» 10 rá»“i so sÃ¡nh id = 10.
    â” CÃ¢u truy váº¥n sá»‘ 1 sá»­ dá»¥ng index.
- Náº¿u cá»™t lÃ  kiá»ƒu kÃ½ tá»±, giÃ¡ trá»‹ so sÃ¡nh lÃ  kiá»ƒu sá»‘ 
    â” MySQL convert tá»«ng giÃ¡ trá»‹ kÃ½ tá»± vá» kiá»ƒu sá»‘ rá»“i so sÃ¡nh
    â” Convert tá»«ng hÃ ng cÃ³ id lÃ  kiá»ƒu kÃ½ tá»± vá» kiá»ƒu sá»‘ rá»“i so sÃ¡nh id = 10
    â” CÃ¢u truy váº¥n sá»‘ 2 khÃ´ng sá»­ dá»¥ng index (do pháº£i duyá»‡t táº¥t cáº£ cÃ¡c hÃ ng Ä‘á»ƒ convert).

### VÃ­ dá»¥ 4
MÃ¬nh Ä‘Ã¡nh index trÃªn cá»™t **name**, theo ae cÃ¢u truy váº¥n dÆ°á»›i Ä‘Ã¢y cÃ³ sá»­ dá»¥ng index khÃ´ng?
```js
SELECT * FROM users WHERE length(name) = 20; 
```
Tráº£ lá»i: CÃ¢u truy váº¥n trÃªn khÃ´ng sá»­ dá»¥ng index.

Giáº£i thÃ­ch: Bá»Ÿi vÃ¬ mÃ¬nh Ä‘Ã¡nh index trÃªn cá»™t name chá»© khÃ´ng pháº£i trÃªn giÃ¡ trá»‹ return tá»« hÃ m length(name), nÃªn cÃ¢u truy váº¥n trÃªn khÃ´ng sá»­ dá»¥ng index.
Tuy nhiÃªn má»™t sá»‘ DBMS nhÆ° Orancle, PostgreeSQL, MySQL 8.0+ Ä‘Ã£ há»— trá»£ function index, nhÆ°ng khi sá»­ dá»¥ng chÃºng ta váº«n cáº§n pháº£i cáº©n tháº­n.

### VÃ­ dá»¥ 5
MÃ¬nh Ä‘Ã¡nh index trÃªn cá»™t **id**, theo ae cÃ¢u truy váº¥n nÃ o dÆ°á»›i Ä‘Ã¢y cÃ³ sá»­ dá»¥ng index?
```js showLineNumbers
SELECT * FROM users WHERE id + 1 = 10;
SELECT * FROM users WHERE id + 0 = 10 - 1;
```
Tráº£ lá»i: Cáº£ hai cÃ¢u truy váº¥n trÃªn Ä‘á»u khÃ´ng sá»­ dá»¥ng index.

Giáº£i thÃ­ch: Do mÃ¬nh Ä‘Ã¡nh index trÃªn cá»™t id, chá»© khÃ´ng pháº£i trÃªn giÃ¡ trá»‹ Ä‘Æ°á»£c tÃ­nh toÃ¡n bá»Ÿi biá»ƒu thá»©c, nÃªn cáº£ hai cÃ¢u truy váº¥n trÃªn sáº½ khÃ´ng sá»­ dá»¥ng index.

## Best practices
á» Ä‘Ã¢y mÃ¬nh cÃ³ Ä‘Æ°a ra má»™t sá»‘ cÃ¡c best practices chÃºng ta nÃªn Ã¡p dá»¥ng khi sá»­ dá»¥ng index.
- Giá»›i háº¡n sá»‘ lÆ°á»£ng cá»™t Ä‘Æ°á»£c Ä‘Ã¡nh index.
- Primary key tá»‘t nháº¥t lÃ  mÃ¬nh nÃªn Ä‘á»ƒ auto-increment.
- Index hoáº¡t Ä‘á»™ng tá»‘t nháº¥t trÃªn cá»™t NOT NULL.
- Náº¿u cÃ³ thá»ƒ thÃ¬ hÃ£y sá»­ dá»¥ng Covering Index.
    - LÃ m giáº£m thao tÃ¡c duyá»‡t cÃ¢y vÃ  giáº£m thiá»ƒu I/O á»• Ä‘Ä©a.
- Náº¿u dá»¯ liá»‡u cá»™t quÃ¡ dÃ i, chÃºng ta cÃ³ thá»ƒ cÃ¢n nháº¯n sá»­ dá»¥ng Prefix Index.
    - LÃ m giáº£m kÃ­ch thÆ°á»›c cá»§a cÃ¢y index.
- ThÆ°á»ng xuyÃªn theo dÃµi vÃ  tá»‘i Æ°u hÃ³a cÃ¡c index.
- TrÃ¡nh cÃ¡ch trÆ°á»ng index khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng.

## Tá»•ng káº¿t
ChÃ ! Cuá»‘i cÃ¹ng thÃ¬ chÃºng mÃ¬nh cÅ©ng Ä‘Ã£ tá»›i há»“i káº¿t cá»§a bÃ i viáº¿t rá»“i.
DÆ°á»›i Ä‘Ã¢y mÃ¬nh cÃ³ tá»•ng há»£p má»™t sá»‘ Ã½ chÃ­nh cá»§a bÃ i viáº¿t.
- Trong cÃ¢y B+ Tree, cÃ¡c node lÃ¡ sáº½ Ä‘Æ°á»£c liÃªn káº¿t vá»›i nhau nhÆ° má»™t linked list â” hiá»‡u quáº£ hÆ¡n khi truy váº¥n theo khoáº£ng.
- Khi duyá»‡t cÃ¡c non-clustered index, cÃ³ Ã­t nháº¥t lÃ  hai thao tÃ¡c duyá»‡t cÃ¢y (hai láº§n I/O á»• Ä‘Ä©a).
Má»™t láº§n duyá»‡t cÃ¢y non-clustered index Ä‘á»ƒ láº¥y ra key, má»™t láº§n duyá»‡t cÃ¢y clustered index Ä‘á»ƒ láº¥y ra giÃ¡ trá»‹ thá»±c cá»§a báº£n ghi.
- Táº­n dá»¥ng composite index vÃ  covering index. ChÃºng ta nÃªn Ä‘áº·t cá»™t cÃ³ sá»‘ lÆ°á»£ng giÃ¡ trá»‹ khÃ¡c nhau nhiá»u lÃªn trÆ°á»›c.

Cáº£m Æ¡n cÃ¡c báº¡n Ä‘Ã£ Ä‘á»c bÃ i viáº¿t cá»§a mÃ¬nh. 
BÃ i viáº¿t cÃ²n thiáº¿u sÃ³t nhiá»u chá»— do lÆ°á»£ng kiáº¿n thá»©c cá»§a mÃ¬nh cÃ²n háº¡n háº¹p.
Hi vá»ng qua bÃ i viáº¿t sáº½ giÃºp cÃ¡c báº¡n cÃ³ cÃ¡i nhÃ¬n tá»•ng quan vá» index trong database.

Háº¹n gáº·p cÃ¡c báº¡n trong cÃ¡c bÃ i viáº¿t sáº¯p tá»›i nhÃ©.

Happy reading! ğŸ»

## Tham kháº£o
1. [ğ’ğğ‹ ğˆğ§ğğğ± - ğğšğ«ğ­ ğŸ (System Design VN)](https://www.facebook.com/groups/systemdesign.vn/permalink/729362075062464)
1. [An in-depth look at Database Indexing](https://www.freecodecamp.org/news/database-indexing-at-a-glance-bb50809d48bd)
1. [MySQL: Building the best INDEX for a given SELECT](https://mysql.rjweb.org/doc.php/index_cookbook_mysql)
1. [What every developer should know about SQL performance](https://use-the-index-luke.com/sql/table-of-contents)